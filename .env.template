# ===== FIBUCA BACKEND - ENVIRONMENT CONFIGURATION (OPTIMIZED) =====
# Copy this to .env and fill in your values

# ===== NODE & PERFORMANCE =====
NODE_ENV=production
PORT=3000
NODE_OPTIONS='--max-old-space-size=256'

# ===== DATABASE (PostgreSQL with Connection Pooling) =====
# âš ï¸ IMPORTANT: Include connection pooling parameters for low-RAM systems
DATABASE_URL="postgresql://fibuca_user:your_secure_password@localhost:5432/fibuca?schema=public&connection_limit=5&pool_timeout=30&idle_in_transaction_session_timeout=30000"

# If using Supabase, format should be:
# DATABASE_URL="postgresql://user:password@host.supabase.co:5432/postgres?schema=public&connection_limit=5"

# ===== AUTHENTICATION =====
JWT_SECRET=your_jwt_secret_key_here_change_in_production
JWT_EXPIRES_IN=2h

# ===== CLOUDINARY (Image Upload & Storage) =====
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# ===== SUPABASE (Optional - for additional services) =====
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# ===== FRONTEND URLS (CORS) =====
VITE_FRONTEND_URL=http://localhost:5173
VITE_BACKEND_URL=http://localhost:3000

# Production URLs:
# VITE_FRONTEND_URL=https://fibuca-frontend.vercel.app
# VITE_BACKEND_URL=https://api.fibuca.com

# ===== UPLOAD LIMITS =====
UPLOAD_SIZE_LIMIT=2097152
MAX_CONCURRENT_UPLOADS=1
REQUEST_TIMEOUT=30000

# ===== LOGGING & DEBUG =====
LOG_LEVEL=warn
DEBUG=false

# ===== EMAIL (Optional - for notifications) =====
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your_email@gmail.com
# SMTP_PASS=your_app_password

# ===== RATE LIMITING =====
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
UPLOAD_RATE_LIMIT_WINDOW_MS=3600000
UPLOAD_RATE_LIMIT_MAX=20

# ===== IMAGE PROCESSING =====
# Previously the app used Uploadcare background removal.  This has been
# replaced by a local Python rembg script; external Uploadcare credentials
# are no longer required in most deployments.
# # Optional Uploadcare configuration (legacy, can be removed):
# # USE_UPLOADCARE=true
# # UPLOADCARE_PUBLIC_KEY=your_public_key
# # UPLOADCARE_SECRET_KEY=your_secret_key
USE_LOCAL_IMAGE_PROCESSING=false
MAX_IMAGE_DIMENSION=800
IMAGE_COMPRESSION_QUALITY=85

# ===== PRISMA =====
# Optional - fine-tune Prisma connection behavior
PRISMA_POOL_SIZE=2

# ===== SECURITY =====
CORS_ORIGIN=http://localhost:5173,https://fibuca-frontend.vercel.app
SESSION_SECRET=your_session_secret_key_here
BCRYPT_ROUNDS=10

# ===== MONITORING & HEALTH =====
HEALTH_CHECK_INTERVAL=60000
ENABLE_MEMORY_MONITORING=true
MEMORY_ALERT_THRESHOLD=350

# ===== OPTIONAL: AWS S3 (if using S3 instead of Cloudinary) =====
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your_key
# AWS_SECRET_ACCESS_KEY=your_secret
# AWS_S3_BUCKET=fibuca-images

# ===== OPTIONAL: SENDGRID (for email) =====
# SENDGRID_API_KEY=your_sendgrid_key

# ===== NOTES =====
# ðŸ”´ CRITICAL FOR 500MB RAM:
# - connection_limit=5 (reduces DB memory overhead)
# - pool_timeout=30 (closes idle connections)
# - idle_in_transaction_session_timeout=30000 (kills hanging queries)
# - NODE_OPTIONS='--max-old-space-size=256' (limits Node heap to 256MB)
#
# ðŸŸ¡ IMPORTANT:
# - Change all "your_*" values to actual credentials
# - Use strong JWT_SECRET (minimum 32 characters)
# - Change BCRYPT_ROUNDS to 12 in production
# - Use HTTPS URLs in production
#
# ðŸŸ¢ MONITORING:
# - /health endpoint returns memory status
# - Check logs if memory > 350MB
# - Auto-restart at 200MB (PM2)
